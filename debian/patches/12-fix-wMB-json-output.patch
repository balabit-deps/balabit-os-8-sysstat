From: Sebastien GODARD <sysstat@users.noreply.github.com>
Date: Sun Nov 24 08:55:40 2019 +0100
Description: iostat: Fix wrong unit used in JSON output

The values for the amount of data read/written or discarded were always
expressed in blocks/s in the JSON output generated by iostat. It should
take into account the unit (blocks, kB, MB) selected by the user.

Signed-off-by: Sebastien GODARD <sysstat@users.noreply.github.com>

Author: Miriam Espa√±a Acebal <miriam.espana@canonical.com>
Origin: upstream, https://github.com/sysstat/sysstat/commit/404eee1417dad8abe6ef49ea6e1469fe6cfdddbe
Bug: https://github.com/sysstat/sysstat/issues/264
Bug-Ubuntu:https://bugs.launchpad.net/ubuntu/+source/sysstat/+bug/1888345
Forwarded: not-needed
Applied-Upstream: Fixed in version 12.3.1, 404eee1417dad8abe6ef49ea6e1469fe6cfdddbe
Last-Update: 2021-08-10

---
 1 file changed, 5 insertions(+), 5 deletions(-)

diff --git a/iostat.c b/iostat.c
index 5aa7a062..41a1dbd5 100644
--- a/iostat.c
+++ b/iostat.c
@@ -857,11 +857,6 @@ void write_disk_stat_header(int *fctr, int *tab, int hpart)
 {
 	char *units, *spc;
 
-	if (DISPLAY_JSON_OUTPUT(flags)) {
-		xprintf((*tab)++, "\"disk\": [");
-		return;
-	}
-
 	if (DISPLAY_KILOBYTES(flags)) {
 		*fctr = 2;
 		units = "kB";
@@ -881,6 +876,11 @@ void write_disk_stat_header(int *fctr, int *tab, int hpart)
 		spc = "";
 	}
 
+	if (DISPLAY_JSON_OUTPUT(flags)) {
+		xprintf((*tab)++, "\"disk\": [");
+		return;
+	}
+
 	if (!DISPLAY_HUMAN_READ(flags)) {
 		printf("Device       ");
 	}
